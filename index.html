<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Quà 20/10 - Ngày Phụ nữ Việt Nam</title>
    <meta name="description" content="Trang quà tặng 20/10 dành cho Ngày Phụ nữ Việt Nam: mở hộp quà và đọc một bức thư yêu thương.">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --pink-glow: rgba(255, 105, 180, 0.35);
            --pink-glow-strong: rgba(255, 105, 180, 0.65);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html{ height: 100%; overflow: hidden; }
        body {
            height: 100vh; width: 100vw; position: relative; overflow: hidden;
            font-family: 'Dancing Script', cursive;
            background-color: #fce4ec; /* Fallback background */
            -webkit-touch-callout: none; -webkit-user-select: none; user-select: none;
            touch-action: manipulation;
        }
        .background-image{ position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        .decorative-asset {
            position: absolute;
            object-fit: contain;
            transition: transform 0.3s ease, opacity 0.5s ease;
            z-index: 1;
            will-change: transform, opacity;
            height: auto; /* Maintain aspect ratio */
        }
        .corner-image.bottom-left { width: 60vw; bottom: 0; left: -19vw; }
        .bottom-left-right { width: 50vw; bottom: -10vh; right: -20vw; z-index: 2; transform:rotate(-20deg); }
        .corner-image-right.bottom-right { width: 90vw; bottom: 0; right: -19vw; }
        .heart1 { width: 30vw; bottom: -8vh; right: 5vw; }
        .heart2 { width: 20vw; bottom: 35vh; right: 22vw; transform: rotate(-19deg); }
        
        @property --scale { syntax: '<number>'; inherits: false; initial-value: 1; }
        .heart1, .heart2{ transform: rotate(var(--rot, 0deg)) scale(var(--scale, 1)); }
        .heart1{ --rot: 0deg; } .heart2{ --rot: -19deg; }
        @keyframes heartbeat { 0%, 100% { --scale: 1; } 50% { --scale: 1.05; } }

        .boxgift{ 
            position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%) scale(var(--scale, 1)); z-index: 3; 
            width: min(12vw, 110px); aspect-ratio: 1 / 1; cursor: pointer; will-change: transform;
        }
        .boxgift .box-gift{ position: absolute; left: 50%; transform: translateX(-50%); width: 100%; height: auto; }
        .boxgift .base{ bottom: 0; z-index: 1; }
        .boxgift .lid{ bottom: 60%; z-index: 2; transform-origin: center; transition: transform .7s ease-out; }
        @keyframes giftPulse { 0%, 100% { --scale: 1; } 50% { --scale: 1.08; } }
        body.is-loaded .boxgift{ animation: giftPulse 1.2s ease-in-out .4s infinite; }
        .boxgift.open .lid{ transform: translateX(-50%) translateY(-55%) rotate(-20deg); }

        @keyframes floatY { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .headline{ 
            position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%); z-index: 3; 
            width: 92vw; text-align: center; font-weight: 700; font-size: clamp(32px, 7.6vw, 90px); 
            line-height: 1.5; padding: 0 2vw; 
            background: linear-gradient(90deg,#ff77aa,#f70e8e,#b9515f); background-size: 300% 100%; 
            -webkit-background-clip: text; background-clip: text; color: transparent; 
            filter: drop-shadow(0 6px 18px var(--pink-glow)); opacity: 0;
            will-change: opacity, filter, background-position;
        }
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        @keyframes glowPulse { 0%, 100% { filter: drop-shadow(0 6px 18px var(--pink-glow)); } 50% { filter: drop-shadow(0 10px 26px var(--pink-glow-strong)); } }
        
        body:not(.is-loaded) .decorative-asset, body:not(.is-loaded) .background-image { opacity: 0; }
        body.is-loaded .background-image{ animation: fadeIn .6s ease-out forwards; }
        body.is-loaded .decorative-asset { animation-name: fadeIn, floatY; animation-duration: .8s, 6s; animation-timing-function: ease-out, ease-in-out; animation-delay: .2s, .8s; animation-iteration-count: 1, infinite; animation-direction: normal, alternate; animation-fill-mode: forwards, none; }
        body.is-loaded .heart1, body.is-loaded .heart2 { animation-name: fadeIn, heartbeat; animation-duration: 1s, 1.5s; animation-delay: .3s, 1.1s; animation-iteration-count: 1, infinite; }
        body.is-loaded .headline{ animation: fadeIn .9s ease-out .3s forwards, gradientShift 6s linear .9s infinite, glowPulse 2.4s ease-in-out .9s infinite; }

        body.hide-ui .decorative-asset, body.hide-ui .headline, body.hide-ui .boxgift{ opacity: 0 !important; pointer-events: none !important; transition: opacity .4s ease !important; }
        
        #pageLoader{ 
            position: fixed; inset: 0; z-index: 1000; display: flex; align-items: center; justify-content: center; 
            background: rgba(0,0,0,.45); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
        }
        #pageLoader .wrap{ display: flex; flex-direction: column; align-items: center; gap: 14px; }
        #pageLoader .spinner{ width: 64px; height: 64px; border: 6px solid rgba(211, 7, 234, 0.35); border-top-color: #a317a5; border-radius: 50%; animation: spin 1s linear infinite; }
        #pageLoader .text{ color: white; font-family: system-ui, sans-serif; font-size: 20px; text-align: center; padding: 0 16px; text-shadow: 0 1px 2px black; }
        @keyframes spin{ to{ transform: rotate(360deg);} }

        /* ---------- SCENE PHONG THƯ ---------- */
        #letterScene{ position: fixed; inset: 0; z-index: 10; display: none; align-items: center; justify-content: center; }
        .envelope-container{ position: relative; cursor: pointer; animation: up 3s linear infinite; }
        @keyframes up{ 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-20px);} }
        
        .envelope-container .envelope{ position: relative; width: clamp(220px, 50vw, 300px); height: clamp(140px, 32vw, 200px); background-color: #f08080; }
        .envelope-container .envelope:before{ content: ""; position: absolute; width: 70%; height: 100%; transform: rotate(45deg); top: -50%; left: 15%; border-radius: 15px 0 0 0; background-color: #f08080; }
        
        .envelope-container .hearts { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .envelope-container .card { position: absolute; background-color: #eae2b7; width: 90%; height: 85%; top: 5%; left: 5%; box-shadow: -3px -3px 50px rgba(0,0,0,0.3); z-index: 2; transition: top 0.5s ease; }
        .envelope-container:hover .card { top: -50%; }
        
        .card:before{ content: ""; position: absolute; border: 2px dotted #003049; width: calc(100% - 20px); height: calc(100% - 20px); top: 10px; left: 10px; }
        .card .text{ position: absolute; font-size: clamp(18px, 4vw, 28px); text-align: center; line-height: 1.3; color: #003049; width: 100%; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 0 8px; font-weight: 700; }
        .card .heart{ background-color: #d62828; display: inline-block; height: 20%; margin: 0 auto; position: absolute; bottom: 10%; left: 0; right: 0; transform: rotate(-45deg); width: 20%; max-width: 30px; max-height: 30px; }
        .card .heart:before, .card .heart:after{ content: ""; background-color: #d62828; border-radius: 50%; height: 100%; position: absolute; width: 100%; }
        .card .heart:before{ top: -50%; left: 0; } .card .heart:after{ left: 50%; top: 0; }
        
        .hearts .heart-particle { position: absolute; background-color: #d62828; height: 10px; width: 10px; transform: rotate(-45deg); }
        .hearts .heart-particle:before, .hearts .heart-particle:after { content: ""; background-color: #d62828; border-radius: 50%; height: 10px; width: 10px; position: absolute; }
        .hearts .heart-particle:before { top: -5px; left: 0; } .hearts .heart-particle:after { left: 5px; top: 0; }
        .heart-particle.one{ left: 10%; animation: heart-fly 1.5s ease-out infinite; animation-delay: 0s; }
        .heart-particle.two{ left: 30%; animation: heart-fly 2s ease-out infinite; animation-delay: 0.2s; }
        .heart-particle.three{ left: 50%; animation: heart-fly 1.2s ease-out infinite; animation-delay: 0.5s; }
        .heart-particle.four{ left: 70%; animation: heart-fly 2.3s ease-out infinite; animation-delay: 0.3s; }
        .heart-particle.five{ left: 90%; animation: heart-fly 1.7s ease-out infinite; animation-delay: 0.8s; }
        @keyframes heart-fly{ 0%{ transform: translateY(0) rotate(-45deg) scale(0.3); opacity: 1;} 100%{ transform: translateY(-150px) rotate(-45deg) scale(1.1); opacity: 0;} }
        
        .envelope-container .front{ position: absolute; border-right: calc(clamp(220px, 50vw, 300px) * 0.55) solid #f4978e; border-top: calc(clamp(140px, 32vw, 200px) * 0.5) solid transparent; border-bottom: calc(clamp(140px, 32vw, 200px) * 0.5) solid transparent; right: 0; top: 0; width: 0; height: 100%; z-index: 3; }
        .envelope-container .front:before{ position: absolute; content: ""; border-left: calc(clamp(220px, 50vw, 300px) * 0.45) solid #f8ad9d; border-top: calc(clamp(140px, 32vw, 200px) * 0.5) solid transparent; border-bottom: calc(clamp(140px, 32vw, 200px) * 0.5) solid transparent; left: calc(clamp(220px, 50vw, 300px) * -0.45); top: calc(clamp(140px, 32vw, 200px) * -0.5); width: 0; height: 0; }
        .envelope-container .shadow{ position: absolute; width: 110%; height: 20px; border-radius: 50%; background-color: rgba(0,0,0,0.3); bottom: -30px; left: -5%; animation: scaleShadow 3s linear infinite; z-index: -1; }
        @keyframes scaleShadow{ 0%,100%{ transform: scaleX(1);} 50%{ transform: scaleX(0.85);} }
        
        .wrapperLetterForm{ 
            position: fixed; inset: 0; z-index: 1000; display: none; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        }
        .boxLetter {
            position: relative; width: clamp(300px, 95vw, 800px); height: clamp(500px, 90vh, 700px);
            background-color: #FFEBEB; border-radius: 20px; padding: clamp(15px, 3vw, 20px);
            box-shadow: rgba(0,0,0,0.24) 0px 3px 8px; display: flex; flex-direction: column;
        }
        .wrapperLetter {
            width: 100%; height: 100%; border: 2px dashed #FF6666; border-radius: inherit;
            display: flex; flex-direction: column; align-items: center; overflow: hidden; 
        }
        .textLetter {
            width: 100%; flex-grow: 1; display: flex; flex-direction: column; align-items: center;
            overflow: hidden; 
        }
        .textLetter h2 {
            font-size: clamp(26px, 5vw, 36px); font-weight: 700; text-align: center;
            padding: 0 15px; margin-top: 15px; margin-bottom: 10px; flex-shrink: 0;
        }
        .textLetter .contentLetter {
            font-size: clamp(16px, 2.5vw, 22px); text-align: left;
            width: 100%; padding: 0 clamp(15px, 5vw, 40px);
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            line-height: 1.6; padding-bottom: 20px;
        }
        .contentLetter::-webkit-scrollbar { width: 8px; }
        .contentLetter::-webkit-scrollbar-thumb { background-color: #f8ad9d; border-radius: 4px; border: 2px solid #FFEBEB; }
        .contentLetter::-webkit-scrollbar-track { background-color: transparent; }

        .close-letter-icon { 
            position: absolute; right: 15px; top: 15px; color: #fff; font-size: 25px; z-index: 101; cursor: pointer;
        }
        
        .signature {
            position: absolute; bottom: clamp(20px, 4vh, 25px); right: clamp(20px, 5vw, 40px); /* Adjusted position */
            font-weight: 700; font-size: clamp(18px, 4vw, 22px); color: #FF6666;
            font-style: italic; white-space: nowrap;
        }

        @media (max-width: 480px){ 
            .boxgift{ width: min(30vw, 90px); top: 50%; }
            .headline{ top: 15%; font-size: clamp(24px, 8.8vw, 56px); }
            .bottom-left-right{ display: none; }
        }
        @media (prefers-reduced-motion: reduce){ 
            * { transition: none !important; animation: none !important; }
        }
    </style>
</head>
<body>    
    <img src="image/bg.png" alt="Ảnh nền" class="background-image">
    <img src="image/b3.png" alt="Trang trí" class="decorative-asset corner-image bottom-left">
    <img src="image/b3.png" alt="Trang trí" class="decorative-asset bottom-left-right">
    <img src="image/b4.png" alt="Trang trí" class="decorative-asset corner-image-right bottom-right">
    <img src="image/b6.png" alt="Trái tim" class="decorative-asset heart1">
    <img src="image/b5.png" alt="Trái tim" class="decorative-asset heart2">
    
    <h1 class="headline">Mừng Ngày Phụ Nữ Việt Nam</h1>

    <div id="letterScene">
        <div class="envelope-container">
            <div class="hearts">
                <div class="heart-particle one"></div> <div class="heart-particle two"></div> <div class="heart-particle three"></div> <div class="heart-particle four"></div> <div class="heart-particle five"></div>
            </div>
            <div class="card">
                <div class="text">Mở thư ra<br>đọc nhé!</div>
                <div class="heart"></div>
            </div>
            <div class="envelope"></div>
            <div class="front"></div>
            <div class="shadow"></div>
        </div>
    </div>

    <div class="wrapperLetterForm">
        <i class="fa-solid fa-xmark close-letter-icon"></i>
        <div class="boxLetter">
            <div class="wrapperLetter">
                <div class="textLetter">
                    <h2></h2>
                    <p class="contentLetter"></p>
                </div>
            </div>
            <div class="signature"></div>
        </div>
    </div>

    <div id="pageLoader">
        <div class="wrap">
            <div class="spinner"></div>
            <div class="text">Đang chuẩn bị quà...</div>
        </div>
    </div>

    <div class="boxgift" id="giftBox">
        <img src="image/nap.png" alt="Nắp hộp" class="box-gift lid">
        <img src="image/hop.png" alt="Thân hộp" class="box-gift base">
    </div>

    <div id="player"></div>

    <script src="./detect-devtools.js"></script>
    <script>
       const config = {
           // BÀI HÁT ĐÃ ĐƯỢC CHỌN: "Hơn Cả Yêu" - Đức Phúc
           youtubeId: 'gJHSD-j7a_A', 
           
           titleLetter: 'Gửi người phụ nữ tuyệt vời nhất!',
           contentLetter: `Hôm nay, ngày 20 tháng 10, là một dịp đặc biệt để tớ có thể bày tỏ lòng biết ơn và sự trân trọng sâu sắc đến bạn – người phụ nữ đã luôn thầm lặng tô điểm cho cuộc đời này thêm rực rỡ.\n\nCó lẽ sẽ chẳng có ngôn từ nào đủ đầy để nói hết về những cống hiến và hy sinh của bạn. Bạn là hiện thân của sự dịu dàng nhưng cũng ẩn chứa một nội lực phi thường. Bạn là dòng sông êm đềm vỗ về những tâm hồn, nhưng cũng là ngọn núi vững chãi trước bão giông. Bạn vừa là người giữ lửa cho tổ ấm, vừa là người thắp lên những ước mơ và hoài bão lớn lao.\n\nThế giới này, và cả cuộc đời tớ, sẽ thật trống trải và vô vị biết bao nếu thiếu đi nụ cười, sự quan tâm và tình yêu thương của bạn. Cảm ơn bạn vì đã luôn là chính bạn – một phiên bản độc nhất và tuyệt vời.\n\nNhân ngày đặc biệt này, tớ không chúc bạn những điều quá cao xa. Tớ chỉ thật tâm mong rằng:\n- Mong bạn có những khoảnh khắc thật sự bình yên cho riêng mình, để lắng nghe và yêu chiều tâm hồn.\n- Mong nụ cười của bạn luôn nở rộ trên môi, không chỉ hôm nay mà trong tất cả 365 ngày của một năm.\n- Mong bạn luôn đủ mạnh mẽ để vượt qua mọi thử thách, nhưng cũng đủ dịu dàng để cho phép bản thân được yếu đuối khi cần.\n- Và hơn hết, mong bạn luôn nhận ra giá trị của bản thân và được sống một cuộc đời trọn vẹn, hạnh phúc theo đúng cách bạn mong muốn.\n\nCảm ơn vì tất cả.`,
           signatureLetter: 'Từ trái tim'
       };

       document.addEventListener('DOMContentLoaded', () => {
            const pageLoader = document.getElementById('pageLoader');
            const giftBox = document.getElementById('giftBox');
            const letterScene = document.getElementById('letterScene');
            const letterWrapper = document.querySelector('.wrapperLetterForm');
            const envelopeContainer = document.querySelector('.envelope-container');
            const closeLetterTrigger = document.querySelector('.close-letter-icon');

            let typingInterval = null; // To control the typing process

            function applyData(data) {
                const titleEl = document.querySelector('.textLetter h2');
                const contentEl = document.querySelector('.textLetter .contentLetter');
                const signatureEl = document.querySelector('.signature');
                if (titleEl) titleEl.textContent = data.titleLetter || '';
                if (contentEl) contentEl.textContent = '';
                if (signatureEl) signatureEl.innerHTML = data.signatureLetter || '';
            }

            function typeWriter(element, text, speed) {
                let i = 0;
                element.innerHTML = '';
                // Clear any previous typing process
                if (typingInterval) clearInterval(typingInterval);

                typingInterval = setInterval(() => {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        i++;
                        // Auto-scroll to the bottom as text appears
                        element.scrollTop = element.scrollHeight;
                    } else {
                        clearInterval(typingInterval);
                    }
                }, speed);
            }

            // Initial Load
            setTimeout(() => {
                applyData(config);
                pageLoader.style.display = 'none';
                document.body.classList.add('is-loaded');
            }, 1500);

            // Open Gift Box
            giftBox.addEventListener('click', () => {
                giftBox.classList.add('open');
                if (window.player && typeof window.player.playVideo === 'function') {
                    try { window.player.setVolume(60); window.player.playVideo(); } 
                    catch (e) { console.error("YouTube Player Error:", e); }
                }
                setTimeout(() => {
                    document.body.classList.add('hide-ui');
                    letterScene.style.display = 'flex';
                }, 1000);
            }, { once: true });

            // Open Letter
            envelopeContainer.addEventListener('click', () => {
                letterWrapper.style.display = 'flex';
                const contentEl = document.querySelector('.textLetter .contentLetter');
                if (config.contentLetter) {
                    typeWriter(contentEl, config.contentLetter, 30); // Speed set to 30ms
                }
            }, { once: true });

            // Close Letter
            closeLetterTrigger.addEventListener('click', () => {
                letterWrapper.style.display = 'none';
                if (typingInterval) clearInterval(typingInterval); // Stop typing if letter is closed
            });
       });
    </script>
    <script>
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        window.player;
        function onYouTubeIframeAPIReady() {
            if (typeof YT !== 'undefined') {
                window.player = new YT.Player('player', {
                    height: '0', width: '0',
                    videoId: config.youtubeId || 'jfKfPfyJRdk',
                    playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': config.youtubeId || 'jfKfPfyJRdk' }
                });
            }
        }
    </script>
</body>
</html>
